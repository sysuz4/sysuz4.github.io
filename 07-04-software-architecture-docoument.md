# Software Architecture Document

## 架构问题

### 服务端

#### 鉴权
由于用户的不同，不同用户能够访问的资源类型也不相同，因此要对restful API中资源的访问进行鉴权，用户只能访问个人的信息，以及其它用户的一些非敏感信息，并且部分API是允许未登录用户调用，而部分API是必须登录用户才能调用的，考虑到这样的鉴权需要，需要一个简单有效的鉴权方案。

#### 不同资源的获取
一些静态资源，例如图片这些，通过数据库来读取的话速度比较慢，而一些文本类型的资源就可以通过关系型数据来进行读取。因此需要有不同类型的服务器来针对不同类型资源的请求进行服务。

#### 分布式负载
当所有请求都在一个服务器上进行处理的时候，可能会导致等待时间较长或者导致无响应的情况，因此需要进行分布式的负载。

#### 可扩展的结构
服务端需要一个可扩展的结构对服务进行分层，从而兼顾开发效率和运行效率。

#### 自动测试与部署
为了简化运维难度，需要在软件架构中考虑并设计自动测试与部署方案。


## 解决方案

### 服务端

#### 鉴权
服务端在路由层之后加入一个可选的鉴权层，通过鉴权层将API权限分为以下两类：

- 只有登录用户才能调用的API
- 任何人都能调用的API

并且在路由层中对登录用户与请求的资源进行对应的鉴权，部分个人敏感资源只有该用户自己才能进行访问

考虑到我们的客户端主要为安卓客户端，因此我们主要采用token机制进行鉴权处理，我们主要采用的是JWT的授权规范。

#### 不同资源的获取
对于图片这种静态资源，我们通过nginx作为静态资源服务器，处理这些静态资源，与此同时，nginx也作为代理服务器，将非静态资源的请求转发给springboot服务端进行处理。

#### 分布式负载
分布式负载同样也是通过nginx进行实现，可以通过nginx将请求分发给不同的服务端进行处理。

#### 可扩展的结构
服务端结构分为六层：
- Router：路由层，根据API路由到不同Controller
- Authorize：鉴权层，提供API鉴权服务
- Controller：控制层，处理HTTP请求，收集参数，检查参数类型和合法性，并调用相应的Service
- Service：服务层，处理业务逻辑
- mapper：处理数据库的交互
- Model：数据层，数据模型

## 逻辑视图
![logic_view](https://github.com/ArtemisZGL/sysuz4.github.io/blob/master/img/packageDiagram.png?raw=true)

## 物理视图
![physic_view](https://github.com/ArtemisZGL/sysuz4.github.io/blob/master/img/backend.png?raw=true)
